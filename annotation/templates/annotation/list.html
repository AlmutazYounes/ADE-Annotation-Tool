{% extends 'annotation/base.html' %}

{% block title %}
{% if annotation %}Annotation #{{ annotation.id }}{% else %}Medical Text Annotation{% endif %}
{% endblock %}

{% block content %}

{% if no_annotations %}
    <!-- Empty State -->
    <div class="row">
        <div class="col-md-12">
            <div class="text-center py-5">
                <div class="annotation-sidebar">
                    <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                    <h4 class="text-muted">No annotations available</h4>
                    <p class="text-muted">Start by importing your medical text data.</p>
                    <a href="{% url 'import_jsonl' %}" class="btn btn-primary btn-clean">
                        <i class="fas fa-upload"></i> Import Data
                    </a>
                </div>
            </div>
        </div>
    </div>
{% else %}
    <!-- Timer and Status Indicator -->
    <div class="timer-status-bar">
        <div class="row">
            <div class="col-md-4">
                <div class="timer-display">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-clock text-primary me-2"></i>
                        <div class="flex-grow-1">
                            <div class="timer-current">
                                <strong>Time: <span id="current-time">00:00</span></strong>
                            </div>
                            <small class="text-muted">Avg: <span id="average-time">--:--</span> per note</small>
                        </div>
                        <div class="timer-controls ms-3">
                            <button class="btn btn-sm btn-success" id="start-btn" onclick="startTimer()">
                                <i class="fas fa-play"></i>
                            </button>
                            <button class="btn btn-sm btn-warning" id="pause-btn" onclick="pauseTimer()" disabled>
                                <i class="fas fa-pause"></i>
                            </button>
                            <button class="btn btn-sm btn-secondary" id="reset-btn" onclick="resetTimer()">
                                <i class="fas fa-redo"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4 text-center">
                <div class="status-indicator">
                    <div class="d-flex align-items-center justify-content-center">
                        {% if annotation.is_validated %}
                            <span class="badge bg-success me-2" id="status-badge">
                                <i class="fas fa-check"></i> Validated
                            </span>
                        {% else %}
                            <span class="badge bg-warning me-2" id="status-badge">
                                <i class="fas fa-clock"></i> Pending
                            </span>
                        {% endif %}
                        <small class="text-muted">#{{ annotation.id }}</small>
                    </div>
                </div>
            </div>
            <div class="col-md-4 text-end">
                <div class="timer-stats">
                    <small class="text-muted">
                        <i class="fas fa-check-circle text-success me-1"></i>
                        <span id="validated-today">0</span> completed today
                    </small>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Statistics Bar -->
    <div class="nav-controls mb-4">
        <div class="row text-center">
            <div class="col-md-6">
                <div class="p-2">
                    <h5 class="text-success mb-1">{{ validated_count }}</h5>
                    <small class="text-muted">Validated</small>
                </div>
            </div>
            <div class="col-md-6">
                <div class="p-2">
                    <h5 class="text-warning mb-1">{{ unvalidated_count }}</h5>
                    <small class="text-muted">Pending</small>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Navigation Controls -->
    <div class="nav-controls">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                {% if prev_annotation %}
                    <a href="{% url 'annotation_single' prev_annotation.id %}" class="btn btn-outline-secondary btn-clean" id="prev-btn">
                        <i class="fas fa-chevron-left"></i> Previous
                    </a>
                {% else %}
                    <button class="btn btn-outline-secondary btn-clean" disabled>
                        <i class="fas fa-chevron-left"></i> Previous
                    </button>
                {% endif %}
            </div>
            
            <div class="text-center">
                <h4 class="mb-0">Medical Text Annotation</h4>
            </div>
            
            <div>
                {% if next_annotation %}
                    <button class="btn btn-success btn-clean" id="next-btn" onclick="validateAndNext()">
                        <i class="fas fa-check"></i> Complete & Next
                    </button>
                {% else %}
                    <button class="btn btn-success btn-clean" onclick="validateCurrent()">
                        <i class="fas fa-check"></i> Complete
                    </button>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Main Annotation Interface -->
    <div class="row">
        <!-- Text Display - Large area for easy reading -->
        <div class="col-lg-8">
            <div class="text-display" id="text-display" data-annotation-id="{{ annotation.id }}">
                {{ annotation.text }}
            </div>
        </div>
        
        <!-- Annotation Sidebar -->
        <div class="col-lg-4">
            <div class="annotation-sidebar">
                <form id="annotation-form">
                    {% csrf_token %}
                    
                    <!-- Drugs Section -->
                    <div class="mb-4">
                        <h5 class="mb-3">
                            <i class="fas fa-pills text-success"></i> Drugs
                            <span class="badge bg-success ms-2" id="drug-count">{{ annotation.drugs|length }}</span>
                        </h5>
                        
                        <!-- Current Drugs -->
                        <div class="mb-3" id="current-drugs">
                            {% for drug in annotation.drugs %}
                                <span class="entity-tag drug-tag" onclick="removeEntity('drugs', '{{ drug }}')">
                                    {{ drug }} <i class="fas fa-times ms-1"></i>
                                </span>
                            {% endfor %}
                        </div>
                        
                        <!-- Add New Drug -->
                        <div class="input-group mb-2">
                            <input type="text" class="form-control" id="new-drug" placeholder="Add drug name..." onkeypress="handleEnterKey(event, 'drugs')">
                            <button type="button" class="btn btn-success" onclick="addEntity('drugs')">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Adverse Events Section -->
                    <div class="mb-4">
                        <h5 class="mb-3">
                            <i class="fas fa-exclamation-triangle text-danger"></i> Adverse Events
                            <span class="badge bg-danger ms-2" id="event-count">{{ annotation.adverse_events|length }}</span>
                        </h5>
                        
                        <!-- Current Adverse Events -->
                        <div class="mb-3" id="current-events">
                            {% for event in annotation.adverse_events %}
                                <span class="entity-tag adverse-event-tag" onclick="removeEntity('adverse_events', '{{ event }}')">
                                    {{ event }} <i class="fas fa-times ms-1"></i>
                                </span>
                            {% endfor %}
                        </div>
                        
                        <!-- Add New Event -->
                        <div class="input-group mb-2">
                            <input type="text" class="form-control" id="new-event" placeholder="Add adverse event..." onkeypress="handleEnterKey(event, 'adverse_events')">
                            <button type="button" class="btn btn-danger" onclick="addEntity('adverse_events')">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
{% endif %}

<!-- Text Selection Popup -->
<div id="selection-popup" class="selection-popup" style="display: none;">
    <div class="popup-content">
        <div class="popup-text mb-2">Add "<span id="selected-text"></span>" as:</div>
        <div class="popup-buttons">
            <button class="btn btn-success btn-sm" onclick="addSelectedEntity('drugs')">
                <i class="fas fa-pills"></i> Drug
            </button>
            <button class="btn btn-danger btn-sm" onclick="addSelectedEntity('adverse_events')">
                <i class="fas fa-exclamation-triangle"></i> Adverse Event
            </button>
            <button class="btn btn-secondary btn-sm" onclick="hideSelectionPopup()">
                <i class="fas fa-times"></i> Cancel
            </button>
        </div>
    </div>
</div>

<!-- Entity Click Popup -->
<div id="entity-popup" class="selection-popup" style="display: none;">
    <div class="popup-content">
        <div class="popup-text mb-2">
            <strong id="entity-type-label"></strong>: "<span id="entity-text"></span>"
        </div>
        <div class="popup-buttons">
            <button class="btn btn-danger btn-sm" onclick="removeSelectedEntity()">
                <i class="fas fa-trash"></i> Remove
            </button>
            <button class="btn btn-secondary btn-sm" onclick="hideEntityPopup()">
                <i class="fas fa-times"></i> Cancel
            </button>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
// Current data
let currentDrugs = {{ annotation.drugs|default:"[]"|safe }};
let currentEvents = {{ annotation.adverse_events|default:"[]"|safe }};
let selectedText = '';
let selectedEntity = '';

// Timer variables
let startTime = null;
let pausedTime = 0;
let timerInterval;
let isRunning = false;
let currentAnnotationId = {{ annotation.id|default:0 }};

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM loaded, initializing...');
    console.log('Initial drugs:', currentDrugs);
    console.log('Initial events:', currentEvents);
    highlightEntities();
    setupTextSelection();
    initializeTimer();
});

// Timer functions
function initializeTimer() {
    calculateAverageTime();
    updateTodayStats();
    updateCurrentTimer();
}

function startTimer() {
    if (!isRunning) {
        startTime = Date.now() - pausedTime;
        isRunning = true;
        timerInterval = setInterval(updateCurrentTimer, 1000);
        
        // Update button states
        document.getElementById('start-btn').disabled = true;
        document.getElementById('pause-btn').disabled = false;
        
        updateCurrentTimer();
    }
}

function pauseTimer() {
    if (isRunning) {
        isRunning = false;
        clearInterval(timerInterval);
        pausedTime = Date.now() - startTime;
        
        // Update button states
        document.getElementById('start-btn').disabled = false;
        document.getElementById('pause-btn').disabled = true;
    }
}

function resetTimer() {
    isRunning = false;
    clearInterval(timerInterval);
    startTime = null;
    pausedTime = 0;
    
    // Update button states
    document.getElementById('start-btn').disabled = false;
    document.getElementById('pause-btn').disabled = true;
    
    // Reset display
    document.getElementById('current-time').textContent = '00:00';
}

function updateCurrentTimer() {
    if (startTime) {
        const elapsed = Math.floor((Date.now() - startTime) / 1000);
        const minutes = Math.floor(elapsed / 60);
        const seconds = elapsed % 60;
        document.getElementById('current-time').textContent = 
            `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    } else {
        document.getElementById('current-time').textContent = '00:00';
    }
}

function calculateAverageTime() {
    const timingData = JSON.parse(localStorage.getItem('annotationTiming') || '[]');
    if (timingData.length === 0) {
        document.getElementById('average-time').textContent = '--:--';
        return;
    }
    
    const totalTime = timingData.reduce((sum, entry) => sum + entry.duration, 0);
    const avgSeconds = Math.floor(totalTime / timingData.length);
    const avgMinutes = Math.floor(avgSeconds / 60);
    const avgSecondsRemainder = avgSeconds % 60;
    
    document.getElementById('average-time').textContent = 
        `${avgMinutes.toString().padStart(2, '0')}:${avgSecondsRemainder.toString().padStart(2, '0')}`;
}

function updateTodayStats() {
    const today = new Date().toDateString();
    const timingData = JSON.parse(localStorage.getItem('annotationTiming') || '[]');
    const todayCount = timingData.filter(entry => new Date(entry.date).toDateString() === today).length;
    document.getElementById('validated-today').textContent = todayCount;
}

function recordAnnotationTime() {
    if (startTime) {
        const duration = Math.floor((Date.now() - startTime) / 1000);
        const timingData = JSON.parse(localStorage.getItem('annotationTiming') || '[]');
        
        timingData.push({
            annotationId: currentAnnotationId,
            duration: duration,
            date: new Date().toISOString(),
            timestamp: Date.now()
        });
        
        // Keep only last 1000 entries to prevent localStorage bloat
        if (timingData.length > 1000) {
            timingData.splice(0, timingData.length - 1000);
        }
        
        localStorage.setItem('annotationTiming', JSON.stringify(timingData));
        
        // Update average time display
        calculateAverageTime();
        updateTodayStats();
    }
}

// Highlight entities in text
function highlightEntities() {
    const textDisplay = document.getElementById('text-display');
    if (!textDisplay) return;
    
    // Get the actual text content from the element instead of template variable
    let text = textDisplay.textContent || textDisplay.innerText;
    console.log('Highlighting text:', text);
    
    // Sort entities by length (longest first) to avoid overlapping issues
    const allEntities = [];
    currentDrugs.forEach(drug => {
        allEntities.push({text: drug, type: 'drug'});
    });
    currentEvents.forEach(event => {
        allEntities.push({text: event, type: 'adverse_event'});
    });
    
    console.log('All entities to highlight:', allEntities);
    allEntities.sort((a, b) => b.text.length - a.text.length);
    
    // Highlight entities - Simple direct matching approach
    allEntities.forEach(entity => {
        console.log('Processing entity:', entity);
        // Escape special characters for regex
        const escapedText = entity.text.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        // Simple global case-insensitive replacement
        const regex = new RegExp(escapedText, 'gi');
        const beforeReplace = text;
        text = text.replace(regex, function(match) {
            console.log('Replacing match:', match, 'with type:', entity.type);
            return '<span class="highlight-' + entity.type + '" onclick="showEntityPopup(\'' + entity.text + '\', \'' + entity.type + '\', event)">' + match + '</span>';
        });
        if (beforeReplace !== text) {
            console.log('Successfully highlighted:', entity.text);
        } else {
            console.log('No match found for:', entity.text);
        }
    });
    
    console.log('Final highlighted text:', text);
    textDisplay.innerHTML = text;
    
    // Force CSS application
    setTimeout(() => {
        const highlightedElements = textDisplay.querySelectorAll('.highlight-adverse_event, .highlight-drug');
        console.log('Found highlighted elements after timeout:', highlightedElements.length);
        highlightedElements.forEach(el => {
            if (el.classList.contains('highlight-adverse_event')) {
                el.style.backgroundColor = '#f8d7da';
                el.style.color = '#721c24';
                el.style.padding = '2px 4px';
                el.style.borderRadius = '3px';
                el.style.border = '1px solid #f5c6cb';
                el.style.fontWeight = '500';
            } else if (el.classList.contains('highlight-drug')) {
                el.style.backgroundColor = '#d4edda';
                el.style.color = '#155724';
                el.style.padding = '2px 4px';
                el.style.borderRadius = '3px';
                el.style.border = '1px solid #c3e6cb';
                el.style.fontWeight = '500';
            }
        });
    }, 100);
}

// Setup text selection
function setupTextSelection() {
    const textDisplay = document.getElementById('text-display');
    if (!textDisplay) return;
    
    textDisplay.addEventListener('mouseup', function(e) {
        // Don't trigger on highlighted entities
        if (e.target.classList.contains('highlight-drug') || e.target.classList.contains('highlight-adverse-event')) {
            return;
        }
        
        setTimeout(() => {
            const selection = window.getSelection();
            const selected = selection.toString().trim();
            
            if (selected && selected.length > 0) {
                selectedText = selected;
                showSelectionPopup(e.pageX, e.pageY);
                selection.removeAllRanges();
            }
        }, 50);
    });
}

// Show selection popup
function showSelectionPopup(x, y) {
    const popup = document.getElementById('selection-popup');
    document.getElementById('selected-text').textContent = selectedText;
    
    popup.style.display = 'block';
    popup.style.left = x + 'px';
    popup.style.top = y + 'px';
}

// Hide selection popup
function hideSelectionPopup() {
    document.getElementById('selection-popup').style.display = 'none';
    selectedText = '';
}

// Show entity popup
function showEntityPopup(entityText, entityType, event) {
    event.stopPropagation();
    selectedEntity = entityText;
    
    const popup = document.getElementById('entity-popup');
    const typeLabel = entityType === 'drug' ? 'Drug' : 'Adverse Event';
    
    document.getElementById('entity-type-label').textContent = typeLabel;
    document.getElementById('entity-text').textContent = entityText;
    
    popup.style.display = 'block';
    popup.style.left = event.pageX + 'px';
    popup.style.top = event.pageY + 'px';
}

// Hide entity popup
function hideEntityPopup() {
    document.getElementById('entity-popup').style.display = 'none';
    selectedEntity = '';
}

// Add selected entity
function addSelectedEntity(type) {
    if (!selectedText) return;
    
    const currentList = type === 'drugs' ? currentDrugs : currentEvents;
    
    if (currentList.includes(selectedText)) {
        alert(`"${selectedText}" is already added.`);
        hideSelectionPopup();
        return;
    }
    
    currentList.push(selectedText);
    updateEntityDisplay(type);
    highlightEntities();
    hideSelectionPopup();
    autoSave();
}

// Remove selected entity
function removeSelectedEntity() {
    const drugIndex = currentDrugs.indexOf(selectedEntity);
    const eventIndex = currentEvents.indexOf(selectedEntity);
    
    if (drugIndex > -1) {
        currentDrugs.splice(drugIndex, 1);
        updateEntityDisplay('drugs');
    } else if (eventIndex > -1) {
        currentEvents.splice(eventIndex, 1);
        updateEntityDisplay('adverse_events');
    }
    
    highlightEntities();
    hideEntityPopup();
    autoSave();
}

// Add entity function
function addEntity(type) {
    const inputId = type === 'drugs' ? 'new-drug' : 'new-event';
    const input = document.getElementById(inputId);
    const entityName = input.value.trim();
    
    if (!entityName) return;
    
    const currentList = type === 'drugs' ? currentDrugs : currentEvents;
    if (currentList.includes(entityName)) {
        alert(`"${entityName}" is already added.`);
        return;
    }
    
    currentList.push(entityName);
    updateEntityDisplay(type);
    highlightEntities();
    autoSave();
    
    input.value = '';
    input.focus();
}

// Remove entity function
function removeEntity(type, entityName) {
    const currentList = type === 'drugs' ? currentDrugs : currentEvents;
    const index = currentList.indexOf(entityName);
    
    if (index > -1) {
        currentList.splice(index, 1);
        updateEntityDisplay(type);
        highlightEntities();
        autoSave();
    }
}

// Update entity display
function updateEntityDisplay(type) {
    const containerId = type === 'drugs' ? 'current-drugs' : 'current-events';
    const countId = type === 'drugs' ? 'drug-count' : 'event-count';
    const container = document.getElementById(containerId);
    const currentList = type === 'drugs' ? currentDrugs : currentEvents;
    const tagClass = type === 'drugs' ? 'drug-tag' : 'adverse-event-tag';
    
    container.innerHTML = '';
    currentList.forEach(entity => {
        const tag = document.createElement('span');
        tag.className = `entity-tag ${tagClass}`;
        tag.innerHTML = `${entity} <i class="fas fa-times ms-1"></i>`;
        tag.onclick = () => removeEntity(type, entity);
        container.appendChild(tag);
    });
    
    document.getElementById(countId).textContent = currentList.length;
}

// Handle enter key
function handleEnterKey(event, type) {
    if (event.key === 'Enter') {
        event.preventDefault();
        addEntity(type);
    }
}

// Auto-save functionality
let autoSaveTimeout;
function autoSave() {
    clearTimeout(autoSaveTimeout);
    autoSaveTimeout = setTimeout(() => {
        saveAnnotation(true); // Silent save
    }, 1000); // Save after 1 second of inactivity
}

// Save annotation
function saveAnnotation(silent = false, validated = false) {
    const annotationId = document.getElementById('text-display').getAttribute('data-annotation-id');
    
    const formData = new FormData();
    formData.append('drugs', currentDrugs.join(','));
    formData.append('adverse_events', currentEvents.join(','));
    formData.append('is_validated', validated ? 'on' : '');
    formData.append('csrfmiddlewaretoken', document.querySelector('[name=csrfmiddlewaretoken]').value);
    
    return fetch(`/annotation/${annotationId}/`, {
        method: 'POST',
        body: formData,
        headers: {
            'X-Requested-With': 'XMLHttpRequest'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success && !silent) {
            // Update status indicator if validated
            if (validated) {
                const statusBadge = document.getElementById('status-badge');
                statusBadge.className = 'badge bg-success me-2';
                statusBadge.innerHTML = '<i class="fas fa-check"></i> Validated';
            }
        }
        return data;
    })
    .catch(error => {
        console.error('Error saving:', error);
        if (!silent) {
            alert('Error saving annotation');
        }
    });
}

// Validate and go to next
function validateAndNext() {
    const nextBtn = document.getElementById('next-btn');
    const originalText = nextBtn.innerHTML;
    
    nextBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
    nextBtn.disabled = true;
    
    // Record timing data before moving to next
    recordAnnotationTime();
    
    saveAnnotation(false, true).then(() => {
        setTimeout(() => {
            {% if next_annotation %}
                window.location.href = '{% url "annotation_single" next_annotation.id %}';
            {% endif %}
        }, 500);
    }).catch(() => {
        nextBtn.innerHTML = originalText;
        nextBtn.disabled = false;
    });
}

// Validate current annotation
function validateCurrent() {
    const btn = document.querySelector('.btn-success');
    const originalText = btn.innerHTML;
    
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
    btn.disabled = true;
    
    // Record timing data
    recordAnnotationTime();
    
    saveAnnotation(false, true).then(() => {
        btn.innerHTML = '<i class="fas fa-check"></i> Completed';
        setTimeout(() => {
            btn.innerHTML = originalText;
            btn.disabled = false;
        }, 2000);
    }).catch(() => {
        btn.innerHTML = originalText;
        btn.disabled = false;
    });
}

// Hide popups when clicking outside
document.addEventListener('click', function(e) {
    if (!document.getElementById('selection-popup').contains(e.target)) {
        hideSelectionPopup();
    }
    if (!document.getElementById('entity-popup').contains(e.target)) {
        hideEntityPopup();
    }
});

// Keyboard shortcuts
document.addEventListener('keydown', function(e) {
    // Ctrl/Cmd + Enter to validate and next
    if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
        e.preventDefault();
        const nextBtn = document.getElementById('next-btn');
        if (nextBtn) {
            validateAndNext();
        } else {
            validateCurrent();
        }
    }
    
    // Ctrl/Cmd + Right Arrow to go to next
    if ((e.ctrlKey || e.metaKey) && e.key === 'ArrowRight') {
        e.preventDefault();
        const nextBtn = document.getElementById('next-btn');
        if (nextBtn) {
            validateAndNext();
        }
    }
    
    // Ctrl/Cmd + Left Arrow to go to previous
    if ((e.ctrlKey || e.metaKey) && e.key === 'ArrowLeft') {
        e.preventDefault();
        const prevBtn = document.getElementById('prev-btn');
        if (prevBtn && !prevBtn.disabled) {
            prevBtn.click();
        }
    }
    
    // Escape to hide popups
    if (e.key === 'Escape') {
        hideSelectionPopup();
        hideEntityPopup();
    }
});
</script>

<style>
/* Timer styles */
.timer-status-bar {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 12px;
    margin-bottom: 16px;
    border: 1px solid #dee2e6;
}

.timer-display {
    font-size: 1rem;
}

.timer-current {
    font-size: 1.1rem;
    color: #007bff;
}

.timer-stats {
    font-size: 0.9rem;
}

.timer-controls {
    display: flex;
    gap: 4px;
}

.timer-controls .btn {
    padding: 4px 8px;
    min-width: 32px;
}

#current-time {
    font-family: 'Courier New', monospace;
    font-weight: bold;
    color: #007bff;
}

#average-time {
    font-family: 'Courier New', monospace;
    color: #28a745;
}

/* Selection popup styles */
.selection-popup {
    position: absolute;
    background: white;
    border: 2px solid #007bff;
    border-radius: 8px;
    padding: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    z-index: 1000;
    min-width: 220px;
}

.popup-content {
    font-size: 0.9rem;
}

.popup-text {
    font-weight: 500;
    color: #333;
}

.popup-buttons {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
}

.popup-buttons .btn {
    padding: 4px 8px;
    font-size: 0.8rem;
    flex: 1;
    min-width: 60px;
}

/* Enhanced highlighting */
.highlight-drug {
    background: linear-gradient(120deg, #d4edda 0%, #c3e6cb 100%);
    color: #155724;
    padding: 2px 4px;
    border-radius: 3px;
    font-weight: 500;
    border: 1px solid #c3e6cb;
    cursor: pointer;
    transition: all 0.2s ease;
    margin: 0 1px;
}

.highlight-drug:hover {
    background: linear-gradient(120deg, #c3e6cb 0%, #b8dcc0 100%);
    transform: translateY(-1px);
    box-shadow: 0 2px 6px rgba(0,0,0,0.15);
}

.highlight-adverse-event {
    background: linear-gradient(120deg, #f8d7da 0%, #f5c6cb 100%);
    color: #721c24;
    padding: 2px 4px;
    border-radius: 3px;
    font-weight: 500;
    border: 1px solid #f5c6cb;
    cursor: pointer;
    transition: all 0.2s ease;
    margin: 0 1px;
}

.highlight-adverse-event:hover {
    background: linear-gradient(120deg, #f5c6cb 0%, #f1b3ba 100%);
    transform: translateY(-1px);
    box-shadow: 0 2px 6px rgba(0,0,0,0.15);
}
</style>
{% endblock %} 